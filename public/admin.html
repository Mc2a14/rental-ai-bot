<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Host Portal - Rental AI Assistant</title>
    <link rel="stylesheet" href="./style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Loading indicator styles */
        #loadingIndicator {
            text-align: center;
            padding: 50px;
            color: #7f8c8d;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        
        .fa-spinner {
            margin-bottom: 20px;
        }
        
        /* Your existing admin styles - KEEP ALL OF THESE */
        html {
            height: 100%;
            height: -webkit-fill-available;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            color: #2c3e50;
            height: 100vh;
            height: -webkit-fill-available;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 30px 20px;
            padding-top: 30px;
            margin: 0;
            overflow-x: hidden;
            overflow-y: auto;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .admin-container {
            max-width: 800px;
            width: 100%;
            max-height: calc(100vh - 60px);
            height: auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: none; /* HIDDEN until authenticated */
            flex-direction: column;
            overflow-y: auto;
            overflow-x: hidden;
            box-sizing: border-box;
            position: relative;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Make the content area have more space */
        #propertyConfig {
            padding: 20px;
            min-height: auto;
        }
        
        .admin-header {
            padding: 20px;
            padding-top: 25px;
            flex-shrink: 0;
        }
        
        @media (max-width: 480px) {
            html {
                height: 100%;
                height: -webkit-fill-available;
                height: 100dvh;
                overflow: hidden;
            }
            
            body {
                padding: 0;
                margin: 0;
                height: 100vh;
                height: -webkit-fill-available;
                height: 100dvh;
                width: 100%;
                overflow: hidden;
                box-sizing: border-box;
                display: flex;
                align-items: stretch;
                justify-content: stretch;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                -webkit-overflow-scrolling: touch;
                padding-bottom: env(safe-area-inset-bottom);
            }
            
            .admin-container {
                border-radius: 0;
                height: 100vh;
                height: -webkit-fill-available;
                height: 100dvh;
                width: 100%;
                max-width: 100%;
                margin: 0;
                padding: 0;
                position: relative;
                box-sizing: border-box;
                display: flex;
                flex-direction: column;
                overflow: hidden;
                box-shadow: none;
                max-height: 100vh;
                max-height: -webkit-fill-available;
                max-height: 100dvh;
            }
            
            .admin-header {
                border-radius: 0;
                border-bottom-left-radius: 28px;
                border-bottom-right-radius: 28px;
                padding: 12px 20px;
                padding-top: max(12px, calc(12px + env(safe-area-inset-top)));
                flex-shrink: 0;
                background: linear-gradient(135deg, #2c3e50, #34495e);
                color: white;
                min-height: auto;
            }
            
            .admin-header h1 {
                color: white !important;
                font-size: 1.5rem;
                margin-bottom: 5px;
            }
            
            .admin-header .header-text h1 {
                color: white !important;
            }
            
            .admin-header p {
                color: rgba(255, 255, 255, 0.9);
                font-size: 0.9rem;
                opacity: 0.9;
            }
            
            .admin-header .header-content {
                display: flex;
                align-items: center;
                gap: 15px;
            }
            
            .admin-header .header-content i {
                font-size: 2rem;
                color: #3498db;
            }
            
            #propertyConfig {
                flex: 1;
                min-height: 0;
                overflow-y: auto;
                overflow-x: hidden;
                -webkit-overflow-scrolling: touch;
                padding: 20px;
                padding-top: 24px;
                padding-bottom: 300px;
                display: flex;
                flex-direction: column;
            }
            
            /* Force scrolling to work - ensure container allows flex child to shrink */
            .admin-container {
                min-height: 0;
            }
            
            .admin-header {
                flex-shrink: 0;
            }
            
            .nav-buttons {
                flex-shrink: 0;
            }
            
            /* CRITICAL: Ensure propertyConfig can scroll - match Guest app pattern exactly */
            #propertyConfig {
                flex: 1;
                min-height: 0;
                overflow-y: auto !important;
            }
            
            /* Remove any height constraints that might prevent scrolling */
            .form-section {
                overflow: visible;
            }
            
            /* Ensure all content inside can expand */
            #propertyConfig > * {
                flex-shrink: 0;
            }
            
            /* Navigation buttons at bottom - sticky positioning */
            .nav-buttons {
                position: sticky;
                bottom: 0;
                flex-shrink: 0;
                padding: 12px 20px;
                padding-bottom: max(20px, calc(20px + env(safe-area-inset-bottom)));
                border-top-left-radius: 28px;
                border-top-right-radius: 28px;
                box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
                z-index: 10;
                background: white;
                border-top: 1px solid #e1e5e9;
                margin-top: auto;
                min-height: auto;
            }
            
            
            /* Setup steps styling for mobile */
            .setup-steps {
                margin-bottom: 20px;
            }
            
            /* Form inputs styling */
            #propertyConfig input,
            #propertyConfig textarea,
            #propertyConfig select {
                font-size: 16px; /* Prevents zoom on iOS */
                min-height: 44px;
            }
            
            /* Ensure rounded corners are visible when scrolling */
            .admin-container::-webkit-scrollbar {
                width: 0;
                background: transparent;
            }
        }
        
        .admin-container::-webkit-scrollbar {
            width: 6px;
        }

        .admin-container::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }
        
        /* Desktop/Chrome fixes - match guest page layout */
        @media (min-width: 481px) {
            body {
                display: flex !important;
                align-items: flex-start !important;
                justify-content: center !important;
                padding: 30px 20px !important;
                padding-top: 30px !important;
                height: 100vh !important;
                min-height: 100vh !important;
                overflow-y: auto !important;
            }
            
            .admin-container {
                max-height: calc(100vh - 60px) !important;
                height: auto !important;
                max-width: 800px !important;
                display: flex !important;
                flex-direction: column !important;
                overflow-y: auto !important;
                overflow-x: hidden !important;
            }
            
            #propertyConfig {
                padding: 20px !important;
                min-height: auto !important;
            }
            
            .admin-header {
                flex-shrink: 0;
                padding: 20px !important;
                padding-top: 25px !important;
            }
        }
        
        .admin-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e1e5e9;
        }
        
        .admin-header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .admin-header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .setup-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }
        
        .setup-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: #e1e5e9;
            z-index: 1;
        }
        
        .step {
            text-align: center;
            position: relative;
            z-index: 2;
            flex: 1;
            min-width: 100px;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
            position: relative;
            z-index: 3;
        }
        
        .step.active .step-number {
            background: #2ecc71;
        }
        
        .step-text {
            font-size: 0.9rem;
            color: #7f8c8d;
            font-weight: 500;
        }
        
        .step.active .step-text {
            color: #2c3e50;
            font-weight: bold;
        }
        
        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
            max-width: 100%;
            overflow: visible;
            min-height: auto;
        }
        
        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-section h3 i {
            color: #3498db;
        }
        
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-group input, 
        .form-group textarea, 
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
            box-sizing: border-box;
            background: white;
            opacity: 1;
            visibility: visible;
        }
        
        .form-group input:focus, 
        .form-group textarea:focus, 
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .form-group textarea {
            height: 80px;
            resize: vertical;
        }
        
        .form-help {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 5px;
            font-style: italic;
        }
        
        .wifi-examples {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #3498db;
        }
        
        .wifi-examples h5 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .wifi-examples ul {
            margin: 0;
            padding-left: 20px;
            color: #7f8c8d;
            font-size: 0.8rem;
        }
        
        .wifi-examples li {
            margin-bottom: 5px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .preview-section {
            background: #e8f4fd;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        .preview-section h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .success-message {
            background: #2ecc71;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
            display: none;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            margin-left: auto;
            margin-right: auto;
            gap: 10px;
            flex-wrap: wrap;
            width: 100%;
            max-width: 100%;
        }

        /* VALIDATION STYLES - ADDED */
        .field-valid {
            border-color: #2ecc71 !important;
            background-color: #f8fff9 !important;
        }

        .field-invalid {
            border-color: #e74c3c !important;
            background-color: #fff0f0 !important;
        }

        .validation-message {
            color: #e74c3c;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }

        .validation-message.show {
            display: block;
        }

        input:not(:placeholder-shown).field-valid,
        textarea:not(:placeholder-shown).field-valid,
        select.field-valid {
            background-color: #f8fff9 !important;
        }
        /* END VALIDATION STYLES */

        /* FAQ Styles */
        .faq-management {
            margin-top: 20px;
        }
        
        .add-faq-form {
            margin-bottom: 20px;
        }
        
        .faqs-list {
            margin-top: 15px;
        }
        
        .faq-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }
        
        .faq-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .faq-question-text {
            font-weight: bold;
            color: #2c3e50;
            flex: 1;
            margin-right: 10px;
        }
        
        .faq-answer-text {
            color: #7f8c8d;
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .faq-meta-info {
            display: flex;
            gap: 10px;
            align-items: center;
            font-size: 12px;
            color: #95a5a6;
        }
        
        .faq-language-badge {
            padding: 3px 8px;
            background: #ecf0f1;
            border-radius: 4px;
            font-size: 11px;
        }
        
        .faq-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 4px;
        }
        
        .btn-edit {
            background: #3498db;
            color: white;
            border: none;
        }
        
        .btn-delete {
            background: #e74c3c;
            color: white;
            border: none;
        }
        
        .no-faqs {
            text-align: center;
            padding: 30px;
            color: #95a5a6;
        }
        
        .no-faqs i {
            font-size: 48px;
            margin-bottom: 10px;
            color: #bdc3c7;
        }
        
        /* Recommendations Styles */
        .recommendations-management {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
            max-width: 100%;
            overflow: visible;
        }

        .add-recommendation-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e1e5e9;
        }

        .current-recommendations {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e1e5e9;
        }

        .recommendation-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
        }

        .place-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .category-badge {
            background: #3498db;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .place-description {
            color: #7f8c8d;
            margin: 5px 0;
            line-height: 1.4;
            font-size: 0.9em;
        }

        .place-notes {
            color: #2ecc71;
            font-style: italic;
            margin: 5px 0 0 0;
            font-size: 0.9em;
        }

        .no-recommendations {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }

        .no-recommendations p {
            margin: 0;
            font-style: italic;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-info {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-info:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        /* Edit Mode Banner */
        .edit-mode-banner {
            animation: fadeIn 0.5s ease;
            margin-bottom: 20px;
        }

        /* WiFi Section Specific Fixes */
        #wifiDetails {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: relative !important;
            z-index: 10 !important;
        }

        /* Ensure all form elements are properly visible */
        .form-section input,
        .form-section textarea,
        .form-section select {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        /* Button spacing */
        .nav-buttons button {
            margin: 0 5px;
            flex: 1;
            min-width: 140px;
            justify-content: center;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .setup-steps {
                flex-direction: row;
                gap: 10px;
            }
            
            .setup-steps::before {
                left: 5%;
                right: 5%;
                top: 20px;
            }
            
            .step {
                min-width: 80px;
            }
            
            .step-text {
                font-size: 0.8rem;
            }
            
            .button-group {
                flex-direction: column;
            }

            .recommendations-management {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 10px;
                justify-content: center;
                align-items: center;
                width: 100%;
                padding-left: 15px;
                padding-right: 15px;
                box-sizing: border-box;
            }
            
            .nav-buttons button {
                width: calc(100% - 30px);
                max-width: calc(100% - 30px);
                justify-content: center;
                min-width: unset;
                margin: 0 auto;
            }

            /* Mobile-specific WiFi fixes */
            #wifiDetails {
                font-size: 16px !important;
                min-height: 44px !important;
            }
        }

        /* Additional safety styles to prevent hiding */
        .form-section * {
            max-height: none !important;
            overflow: visible !important;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- Loading indicator (shown while checking auth) -->
    <div id="loadingIndicator">
        <i class="fas fa-spinner fa-spin fa-2x"></i>
        <p>Loading Host Portal...</p>
    </div>
    
    <!-- The entire admin setup form (hidden until auth) -->
    <div class="admin-container" id="adminContainer">
        <div class="admin-header">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: wrap; gap: 10px;">
                <div class="header-content" style="display: flex; align-items: center; gap: 15px;">
                    <i class="fas fa-robot" style="font-size: 2rem; color: #3498db;"></i>
                    <div class="header-text" style="display: flex; flex-direction: column;">
                        <h1 style="margin: 0; font-size: 1.5rem; color: white !important;">GuestBud</h1>
                        <p style="margin: 0; font-size: 0.9rem; opacity: 0.9; color: rgba(255, 255, 255, 0.9) !important;">Property Setup</p>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <select id="propertySelector" style="padding: 10px 15px; border: 2px solid #3498db; border-radius: 5px; font-size: 14px; background: white; color: #2c3e50; cursor: pointer; min-width: 200px; display: none;">
                        <option value="">Loading properties...</option>
                    </select>
                    <button id="newPropertyBtn" style="padding: 10px 20px; background: #2ecc71; color: white; border: none; border-radius: 5px; font-size: 14px; cursor: pointer; display: none;">
                        <i class="fas fa-plus"></i> New Property
                    </button>
                    <a href="/analytics.html" style="padding: 10px 20px; background: #3498db; color: white; text-decoration: none; border-radius: 5px; font-size: 14px;">
                        <i class="fas fa-chart-line"></i> View Analytics
                    </a>
                </div>
            </div>
            <p>Configure your Rental AI Assistant in 3 simple steps</p>
        </div>

        <div class="setup-steps">
            <div class="step active" id="step1">
                <div class="step-number">1</div>
                <div class="step-text">Basic Info</div>
            </div>
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <div class="step-text">Details</div>
            </div>
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <div class="step-text">Review</div>
            </div>
        </div>

        <form id="propertyConfig" novalidate onsubmit="return false;">
            <!-- Step 1: Basic Information -->
            <div class="form-section" id="section1">
                <h3><i class="fas fa-home"></i> Basic Property Information</h3>
                
                <div class="form-group">
                    <label for="propertyName">Property Name *</label>
                    <input type="text" id="propertyName" required placeholder="e.g., Sunset Beach Villa">
                    <div class="form-help">This will be displayed to your guests</div>
                </div>
                
                <div class="form-group">
                    <label for="propertyAddress">Property Address *</label>
                    <input type="text" id="propertyAddress" required placeholder="e.g., 123 Ocean View Drive, Miami Beach, FL 33139">
                </div>
                
                <div class="form-group">
                    <label for="propertyType">Property Type *</label>
                    <select id="propertyType" required>
                        <option value="">Select a property type</option>
                        <option value="Vacation Home">Vacation Home</option>
                        <option value="Apartment">Apartment</option>
                        <option value="Villa">Villa</option>
                        <option value="Condo">Condominium</option>
                        <option value="Cabin">Cabin</option>
                        <option value="Beach House">Beach House</option>
                        <option value="Mountain Retreat">Mountain Retreat</option>
                        <option value="City Loft">City Loft</option>
                    </select>
                    <div class="validation-message" id="propertyTypeValidation">Please select a property type</div>
                </div>
            </div>

            <!-- Step 2: Contact & Details -->
            <div class="form-section" id="section2" style="display: none;">
                <h3><i class="fas fa-phone"></i> Contact Information</h3>
                
                <div class="form-group">
                    <label for="hostContact">Host Contact Information *</label>
                    <input type="text" id="hostContact" required placeholder="e.g., John Smith - (555) 123-4567">
                    <div class="form-help">How guests can reach you directly</div>
                </div>
                
                <div class="form-group">
                    <label for="maintenanceContact">Maintenance Contact *</label>
                    <input type="text" id="maintenanceContact" required placeholder="e.g., (555) 987-6543 (24/7)">
                </div>
                
                <h3 style="margin-top: 30px;"><i class="fas fa-clock"></i> Check-in & Check-out</h3>
                
                <div class="form-group">
                    <label for="checkInTime">Check-in Time *</label>
                    <input type="text" id="checkInTime" required placeholder="e.g., 3:00 PM">
                </div>
                
                <div class="form-group">
                    <label for="checkOutTime">Check-out Time *</label>
                    <input type="text" id="checkOutTime" required placeholder="e.g., 11:00 AM">
                </div>
                
                <div class="form-group">
                    <label for="lateCheckout">Late Check-out Policy</label>
                    <input type="text" id="lateCheckout" placeholder="e.g., Available upon request ($50 fee after 1 PM)">
                </div>
            </div>

            <!-- Step 3: Amenities, Rules, Appliances & Recommendations -->
            <div class="form-section" id="section3" style="display: none;">
                <h3><i class="fas fa-wifi"></i> Amenities & WiFi</h3>
                
                <div class="form-group">
                    <label for="wifiDetails">WiFi Details *</label>
                    <input type="text" id="wifiDetails" required placeholder="e.g., Network: VillaChamitos_Guest, Password: Welcome2024">
                    <div class="form-help">Your guests will need this information to connect to WiFi</div>
                    
                    <div class="wifi-examples">
                        <h5>üìù Example WiFi formats:</h5>
                        <ul>
                            <li><strong>Simple:</strong> Network: VillaChamitos, Password: Welcome123</li>
                            <li><strong>Detailed:</strong> SSID: VillaChamitos_Guest | Password: StayWithUs2024</li>
                            <li><strong>Multiple networks:</strong> Main: VillaChamitos (Welcome123) | Backup: VillaChamitos_5G (Welcome123)</li>
                        </ul>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="amenities">Key Amenities *</label>
                    <textarea id="amenities" required placeholder="Enter each amenity on a new line or separated by commas&#10;‚Ä¢ Air Conditioning&#10;‚Ä¢ Kitchen&#10;‚Ä¢ Smart TV&#10;‚Ä¢ Coffee Maker&#10;‚Ä¢ Parking Spot A15"></textarea>
                    <div class="form-help">List the most important amenities your guests should know about</div>
                </div>

                <h3 style="margin-top: 30px;"><i class="fas fa-clipboard-list"></i> House Rules</h3>
                
                <div class="form-group">
                    <label for="houseRules">House Rules *</label>
                    <textarea id="houseRules" required placeholder="Enter each house rule on a new line&#10;‚Ä¢ No smoking inside the property&#10;‚Ä¢ No pets allowed&#10;‚Ä¢ Quiet hours: 10 PM - 7 AM&#10;‚Ä¢ No parties or events&#10;‚Ä¢ Turn off lights and AC when leaving&#10;‚Ä¢ Dispose of trash in designated bins&#10;‚Ä¢ Report any damages immediately"></textarea>
                    <div class="form-help">List your specific house rules for guests to follow. These will be shared when guests ask about rules.</div>
                </div>

                <!-- Appliance Instructions Section -->
                <h3 style="margin-top: 30px;"><i class="fas fa-tools"></i> Appliance Instructions</h3>
                <p class="section-description">Add instructions for appliances guests commonly ask about. Include photos to make it easy!</p>

                <div class="appliance-management">
                    <!-- Add New Appliance Form -->
                    <div class="add-appliance-form" style="background: white; padding: 20px; border-radius: 10px; border: 2px solid #e1e5e9; margin-bottom: 20px;">
                        <h4>Add New Appliance</h4>
                        
                        <div class="form-group">
                            <label for="appliance-name">Appliance Name *</label>
                            <input type="text" id="appliance-name" placeholder="e.g., Living Room Smart TV" class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="appliance-type">Appliance Type *</label>
                            <select id="appliance-type" class="form-select">
                                <option value="TV/Entertainment">TV/Entertainment System</option>
                                <option value="Thermostat">Thermostat/AC</option>
                                <option value="Kitchen">Kitchen Appliance</option>
                                <option value="Laundry">Washer/Dryer</option>
                                <option value="Coffee">Coffee Maker</option>
                                <option value="Pool/Spa">Pool/Hot Tub</option>
                                <option value="Security">Security System</option>
                                <option value="Lighting">Smart Lighting</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="appliance-instructions">Step-by-Step Instructions *</label>
                            <textarea id="appliance-instructions" placeholder="Enter clear, simple steps:
1. Find the remote on the coffee table
2. Press the power button (top left)
3. Use arrow keys to navigate
4. For Netflix, press the red button" class="form-textarea" rows="4"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="appliance-troubleshooting">Troubleshooting Tips (Optional)</label>
                            <textarea id="appliance-troubleshooting" placeholder="Common issues and solutions:
‚Ä¢ If remote doesn't work, check batteries
‚Ä¢ For no sound, check volume on both TV and soundbar
‚Ä¢ To reset, unplug for 30 seconds" class="form-textarea" rows="3"></textarea>
                        </div>
                        
                        <button type="button" class="btn btn-primary" onclick="addAppliance()">
                            <i class="fas fa-plus"></i> Add Appliance
                        </button>
                    </div>
                    
                    <!-- Current Appliances List -->
                    <div class="current-appliances" style="background: white; padding: 20px; border-radius: 10px; border: 2px solid #e1e5e9;">
                        <h4>Your Appliance Instructions</h4>
                        <div id="appliances-list" class="appliances-list">
                            <!-- Appliances will be listed here -->
                        </div>
                    </div>
                </div>

                <!-- Recommended Places Section -->
                <h3 style="margin-top: 30px;"><i class="fas fa-map-marker-alt"></i> Recommended Local Places</h3>
                <p class="section-description">Add your favorite local restaurants, attractions, and spots for guests to discover.</p>
                
                <div class="recommendations-management">
                    <!-- Add New Recommendation Form -->
                    <div class="add-recommendation-form">
                        <h4>Add New Recommendation</h4>
                        
                        <div class="form-group">
                            <label for="place-name">Place Name *</label>
                            <input type="text" id="place-name" placeholder="e.g., Joe's Pizza" class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="place-category">Category *</label>
                            <select id="place-category" class="form-select">
                                <option value="Restaurant">Restaurant</option>
                                <option value="Cafe">Cafe</option>
                                <option value="Bar">Bar</option>
                                <option value="Beach">Beach</option>
                                <option value="Park">Park</option>
                                <option value="Attraction">Attraction</option>
                                <option value="Shop">Shop</option>
                                <option value="Grocery">Grocery Store</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="place-description">Description</label>
                            <textarea id="place-description" placeholder="Why do you recommend this place? What makes it special?" class="form-textarea"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="place-notes">Special Notes/Tips</label>
                            <input type="text" id="place-notes" placeholder="e.g., Try the pasta, Great for sunset views" class="form-input">
                        </div>
                        
                        <button type="button" class="btn btn-primary" onclick="addRecommendation()">
                            <i class="fas fa-plus"></i> Add Recommendation
                        </button>
                    </div>
                    
                    <!-- Current Recommendations List -->
                    <div class="current-recommendations">
                        <h4>Your Current Recommendations</h4>
                        <div id="recommendations-list" class="recommendations-list">
                            <!-- Recommendations will be listed here -->
                        </div>
                    </div>
                </div>
                
                <!-- FAQ Management Section -->
                <h3 style="margin-top: 30px;"><i class="fas fa-question-circle"></i> Frequently Asked Questions (FAQs)</h3>
                <p class="section-description">Add common questions and answers to help guests quickly find information. These will be available in the chat and can improve your AI responses.</p>
                
                <div class="faq-management" style="margin-bottom: 30px;">
                    <!-- Add New FAQ Form -->
                    <div class="add-faq-form" style="background: white; padding: 20px; border-radius: 10px; border: 2px solid #e1e5e9; margin-bottom: 20px;">
                        <h4>Add New FAQ</h4>
                        
                        <div class="form-group">
                            <label for="faq-question">Question *</label>
                            <input type="text" id="faq-question" placeholder="e.g., What time is check-in?" class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="faq-answer">Answer *</label>
                            <textarea id="faq-answer" placeholder="e.g., Check-in is at 3:00 PM. You can check in anytime after 3 PM. If you need early check-in, please contact us in advance." class="form-textarea" rows="4"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="faq-language">Language</label>
                            <select id="faq-language" class="form-select">
                                <option value="en">English</option>
                                <option value="es">Espa√±ol</option>
                                <option value="fr">Fran√ßais</option>
                            </select>
                        </div>
                        
                        <button type="button" class="btn btn-primary" id="addFAQBtn">
                            <i class="fas fa-plus"></i> Add FAQ
                        </button>
                    </div>
                    
                    <!-- Current FAQs List -->
                    <div class="current-faqs" style="background: white; padding: 20px; border-radius: 10px; border: 2px solid #e1e5e9;">
                        <h4>Your Current FAQs</h4>
                        <div id="faqs-list" class="faqs-list">
                            <!-- FAQs will be listed here -->
                        </div>
                    </div>
                </div>
                
                <div class="preview-section" id="previewSection">
                    <h4><i class="fas fa-eye"></i> Configuration Preview</h4>
                    <div id="previewContent"></div>
                </div>
            </div>

            <div class="nav-buttons">
                <button type="button" class="btn btn-secondary" id="prevBtn" style="display: none;">
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                
                <button type="button" class="btn btn-primary" id="nextBtn">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
                
                <button type="button" class="btn btn-primary" id="submitBtn" style="display: none;">
                    <i class="fas fa-check"></i> Save Configuration
                </button>
                
                <!-- Reset and Backup buttons will be added by JavaScript -->
            </div>
        </form>

        <div class="success-message" id="successMessage">
            <h3><i class="fas fa-check-circle"></i> Configuration Saved Successfully!</h3>
            <p>Your Rental AI Assistant is now configured with your property information.</p>
            <button class="btn btn-primary" id="testAIBtn">
                <i class="fas fa-robot"></i> Test Your AI Assistant
            </button>
        </div>
    </div>

    <!-- Scripts - CRITICAL FIX: Load auth.js FIRST, then handle auth, THEN load admin.js -->
    <script src="./auth.js"></script>
    <script>
        // Global backup function for Next button
        function handleNextButton() {
            console.log("üîò Global Next button handler called");
            if (window.propertySetup && typeof window.propertySetup.nextStep === 'function') {
                window.propertySetup.nextStep();
            } else {
                console.error("PropertySetup not available");
                alert("Please wait for the page to fully load, then try again.");
            }
        }
        
        // Direct button handler as backup - multiple attempts
        function attachNextButtonHandler() {
            const nextBtn = document.getElementById('nextBtn');
            if (nextBtn) {
                // Remove any existing onclick
                nextBtn.removeAttribute('onclick');
                
                // Add inline onclick as ultimate backup
                nextBtn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log("üîò Inline onclick handler triggered");
                    if (window.propertySetup && typeof window.propertySetup.nextStep === 'function') {
                        window.propertySetup.nextStep();
                    } else {
                        console.error("PropertySetup not available");
                        alert("Please wait for page to load completely.");
                    }
                    return false;
                };
                
                console.log("‚úÖ Added inline onclick handler to Next button");
                return true;
            }
            return false;
        }
        
        // Try multiple times to ensure it attaches
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(attachNextButtonHandler, 500);
            setTimeout(attachNextButtonHandler, 1000);
            setTimeout(attachNextButtonHandler, 2000);
            
            // Attach Test AI Assistant button handler
            setTimeout(function() {
                const testBtn = document.getElementById('testAIBtn');
                if (testBtn) {
                    testBtn.addEventListener('click', function() {
                        window.location.href = '/';
                    });
                    console.log('‚úÖ Test AI Assistant button handler attached');
                }
            }, 500);
        });
    </script>
    <script>
        // Wait for auth system to initialize
        document.addEventListener('DOMContentLoaded', async function() {
            console.log("üîê Checking authentication...");
            console.log("üìÖ Admin page loaded at:", new Date().toISOString());
            
            try {
                // Wait a bit for auth.js to load
                if (typeof isAuthenticated === 'undefined') {
                    console.log("‚è≥ Waiting for auth.js to load...");
                    await new Promise(resolve => {
                        let attempts = 0;
                        const checkAuth = setInterval(() => {
                            attempts++;
                            if (typeof isAuthenticated !== 'undefined' || attempts > 20) {
                                clearInterval(checkAuth);
                                resolve();
                            }
                        }, 100);
                    });
                }
                
                // Initialize auth system
                if (typeof initAuthSystem === 'function') {
                    initAuthSystem();
                }
                
                // Use your existing auth.js functions (now async)
                if (typeof isAuthenticated === 'function') {
                    const authCheck = await isAuthenticated();
                    if (authCheck) {
                        // User is authenticated - show admin interface
                        console.log("‚úÖ User authenticated, showing admin interface");
                        document.getElementById('loadingIndicator').style.display = 'none';
                        document.getElementById('adminContainer').style.display = 'block';
                        
                        // Load admin.js dynamically but WAIT for DOM to be ready
                        const loadAdminJS = function() {
                            console.log("üîÑ Loading admin.js...");
                            const adminScript = document.createElement('script');
                            adminScript.src = './admin.js';
                            adminScript.onload = function() {
                                console.log("‚úÖ admin.js loaded successfully");
                                
                                // CRITICAL: Initialize PropertySetup immediately after script loads
                                // The DOMContentLoaded in admin.js won't fire because script loads dynamically
                                setTimeout(function() {
                                    if (typeof PropertySetup !== 'undefined') {
                                        try {
                                            console.log("üîÑ Initializing PropertySetup after script load...");
                                            window.propertySetup = new PropertySetup();
                                            console.log("‚úÖ PropertySetup initialized successfully!");
                                            console.log("PropertySetup object:", window.propertySetup);
                                            
                                            // Re-attach button handlers now that PropertySetup exists
                                            attachNextButtonHandler();
                                        } catch (error) {
                                            console.error("‚ùå Error initializing PropertySetup:", error);
                                        }
                                    } else {
                                        console.error("‚ùå PropertySetup class not found in admin.js");
                                    }
                                }, 100);
                                
                                // Force validation to run after everything is loaded
                                setTimeout(() => {
                                    if (window.propertySetup && typeof window.propertySetup.validateCurrentStep === 'function') {
                                        window.propertySetup.validateCurrentStep();
                                    }
                                }, 500);
                            };
                            adminScript.onerror = function() {
                                console.error("‚ùå Failed to load admin.js");
                                alert("Failed to load admin interface. Please refresh the page.");
                            };
                            document.body.appendChild(adminScript);
                        };
                        
                        // Wait a bit to ensure DOM is fully ready
                        setTimeout(loadAdminJS, 100);
                    } else {
                        // Not authenticated - show login modal using existing auth.js function
                        console.log("üîí User not authenticated, showing login modal");
                        
                        // Hide loading indicator
                        document.getElementById('loadingIndicator').style.display = 'none';
                        
                        // Use the showLoginModal function from auth.js
                        if (typeof showLoginModal === 'function') {
                            showLoginModal();
                            
                            // Use handleLogin from auth.js (it's already async)
                            // No need to override - handleLogin already handles reload
                        } else {
                            // Fallback: redirect to main page
                            alert('Authentication system not available. Redirecting to main page.');
                            window.location.href = '/';
                        }
                    }
                } else {
                    console.error("‚ùå isAuthenticated function not found");
                    alert('Authentication system error. Please refresh the page.');
                }
            } catch (error) {
                console.error("‚ùå Error in admin page initialization:", error);
                document.getElementById('loadingIndicator').innerHTML = `
                    <div style="color: #e74c3c;">
                        <h3>Error loading admin page</h3>
                        <p>${error.message}</p>
                        <button onclick="window.location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Reload Page
                        </button>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
